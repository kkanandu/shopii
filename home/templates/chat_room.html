{% extends 'header.html' %}
{% block header %}

<!-- <div class="container my-5 text-center">
    <div class="card shadow-sm p-5">
        <h1 class="text-danger mb-3">ðŸš« Unauthorized Access</h1>
        <p class="lead">You do not have permission to view this page or perform this action.</p>
        <a href="{% url 'home' %}" class="btn btn-primary mt-4">Go Back to Home</a>
    </div>
</div> -->



{% load static %}


<div class="container mt-5">
  <div class="card shadow p-4">
    <h4 class="mb-3 text-success">Chat with {{ receiver.username }}</h4>
    <div id="chat-box" style="height: 300px; overflow-y: scroll; border: 1px solid #ccc; padding: 10px;">
      {% for msg in messages %}
          <div>
              <strong>{{ msg.sender.username }}:</strong> {{ msg.content }}
          </div>
      {% endfor %}
  </div>
  
    <div class="input-group mt-3">
      <input type="text" id="message-input" class="form-control" placeholder="Type a message...">
      <button id="send-btn" class="btn btn-success">Send</button>
    </div>
  </div>
</div>

<script>
  const receiverId = "{{ receiver.id }}";
  const chatSocket = new WebSocket(
    'ws://' + window.location.host + '/ws/chat/' + receiverId + '/'
  );

  const chatBox = document.getElementById('chat-box');
  const input = document.getElementById('message-input');
  const sendBtn = document.getElementById('send-btn');

  chatSocket.onmessage = function (e) {
    const data = JSON.parse(e.data);
    const msg = document.createElement('div');
    msg.innerHTML = `<strong>${data.sender}:</strong> ${data.message}`;
    chatBox.appendChild(msg);
    chatBox.scrollTop = chatBox.scrollHeight;
  };

  sendBtn.onclick = function () {
    const message = input.value.trim();
    if (message !== '') {
      chatSocket.send(JSON.stringify({
        'message': message
      }));
      input.value = '';
    }
  };

  input.addEventListener("keyup", function (event) {
    if (event.key === "Enter") {
      sendBtn.click();
    }
  });
</script>
{% endblock %}